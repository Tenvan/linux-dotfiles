#!/usr/bin/env bash

. "$HOME/.scripts/defs"

if [ $IS_MANJARO = true ]; then
	sudo pacman -S --needed yay
fi

# Init Install
initInstall "install_init"

# Config pacman
if [ -f /etc/pacman.conf ]; then
	sudo sed -i 's/^#Color$/Color/g' /etc/pacman.conf
	sudo sed -i 's/^.*ParallelDownloads.*$/ParallelDownloads = 10/g' /etc/pacman.conf
	sudo sed -i 's/^.*VerbosePkgLists.*$/VerbosePkgLists/g' /etc/pacman.conf
	errorCheck "pacman config"
fi

# Config pamac
if [ -f /etc/pamac.conf ]; then
	sudo sed -i 's/^.*ILoveCandy$/ILoveCandy/g' /etc/pamac.conf
	sudo sed -i 's/^.*EnableAUR$/EnableAUR/g' /etc/pamac.conf
	sudo sed -i 's/^.*KeepBuiltPkgs$/KeepBuiltPkgs/g' /etc/pamac.conf
	errorCheck "pamac config"
fi

if [ $IS_FEDORA_BASED = true ]; then
	sudo $PACKER install git go ruby rust make
else
	eval "sudo pacman -S --needed $PACKER_ALL git base-devel curl colorgcc go ruby rust"
fi
errorCheck "installation base-devel"

# disable sudo password
echo "Cmnd_Alias INSTALL = /usr/bin/pacman, /usr/share/pacman
Cmnd_Alias POWER = /usr/bin/pm-hibernate, /usr/bin/pm-powersave, /usr/bin/pm-suspend-hybrid, /usr/bin/pm-suspend
Defaults timestamp_timeout=300
$USER ALL=(ALL) NOPASSWD:INSTALL,POWER
$USER ALL=(ALL) NOPASSWD:ALL" | sudo tee /etc/sudoers.d/100-myrules

sudo chmod -R -v +x ~/.scripts
sudo chmod -R -v +x ~/.bin
errorCheck "set script flags"

# base install tools
install fastfetch
install exa
install kitty
install lsd
install micro
install polkit
install ranger

# base install awesome 
if [ $IS_MANJARO = true ]; then
    install manjaro-awesome-settings
fi
if [ $IS_ARCO = true ]; then
    install arcolinux-config-awesome-git
fi

# awesome
install luarocks

if [ $IS_ARCH_BASED = true ]; then
	install awesome-git
	install awmtt
	install picom
	install lain-git
	install rofi
	install sysstat
fi 

if [ $IS_FEDORA_BASED = true ]; then
	install awesome
	install picom
	install rofi
	install sysstat
fi

###############################
# uninstall unneeded packages #
###############################
fullUninstall

#################################
# install all (needed) packages #
#################################
fullInstall

## FINISHING #
finish

sudo luarocks install lain

if [ $IS_ARCH_BASED = true ]; then
	sudo pamac build --no-confirm qt5-styleplugins
fi
