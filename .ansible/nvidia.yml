---
- hosts: localhost
  connection: local
  name: "==========> Install Tenvans Dotfiles with AwesomeWm Desktop <=========="
  become: true

  # install galaxy roles
  # roles:
   # - role: robertdebock.bootstrap
   # - role: robertdebock.rpmfusion

  vars:
    is_dry: false
    is_arch_based: false
    is_arch: false
    is_arcolinux: false
    is_manjaro: false

    is_rhel_based: false
    is_rhel: false
    is_fedora: false
    is_centos: false

    is_debian_based: false
    is_debian: false
    is_ubuntu: false

    fedora_init:
      - akmod-nvidia

  tasks:
    - name: "=====> Initiate <====="
      ansible.builtin.include_tasks: lib/inits.yml

    - name: Fedora nvidia
      when: is_fedora
      block:

        - name: Install nvidia driver
          ansible.builtin.include_tasks: lib/install.yml

        - name: Remove nouveau driver    
          ansible.builtin.blockinfile:
            path: /etc/modprobe.d/blacklist-nouveau.conf
            create: true
            block: |
              blacklist nouveau
              options nouveau modeset=0

        - name: Create new initramfrs with nvidia
          shell: dracut /boot/initramfs-$(uname -r).img $(uname -r) --force -v

        - name: Grub update
          shell: sudo grub2-mkconfig -o /boot/grub2/grub.cfg

