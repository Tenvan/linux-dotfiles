---
####################################################################################################################
# Installer Part
#
# Installs all packages defined in distro dependend arrays
#
# Arrays:
#   - global_init          => for all distros
#   - rhel_based_init      => for all RHEL/CentOS/Fedora distros
#   - archlinux_based_init => for all ArchLinux distro
#   - fedora_init          => Fedora only packages
#   - arcolinux_init       => ArcoLinux only packages
#   - manjaro_init         => Manjaro only packages
####################################################################################################################

####################################################################################################################
# Install Fedora Based Part
####################################################################################################################
- block:
  - set_fact:
      combined_array: "{{ (global_init | default([])) + (rhel_based_init | default([])) + (fedora_init | default([])) }}"
  - debug:
      msg: "{{ combined_array }}"
  - name: "[INSTALL][DNF] FedoraPackages"
    become: true
    dnf:
      state: present
      name: "{{ combined_array }}"
    when: is_dry is false and combined_array|length > 0
  when: is_fedora

####################################################################################################################
# Install ArcoLinux Part
####################################################################################################################
- block:
  - set_fact:
      combined_array: "{{ (global_init | default([])) + (archlinux_based_init | default([])) + (arcolinux_init | default([])) }}"
  - debug:
      msg: "{{ combined_array }}"
  - name: "[INSTALL][AUR] ArcoLinuxPackages"
    become: false
    kewlfft.aur.aur:
      state: present
      name: "{{ combined_array }}"
#    when: is_dry is false and combined_array is not undefined and combined_array is not none and combined_array|length > 0
    when: is_dry is false and combined_array|length > 0
  when: is_arcolinux

####################################################################################################################
# Install Manjaro Part
####################################################################################################################
- block:
  - set_fact:
      combined_array: "{{ (global_init | default([])) + (archlinux_based_init | default([])) + (manjaro_init | default([])) }}"
  - debug:
      msg: "{{ combined_array }}"
  - name: "[INSTALL][AUR] ManjaroPackages"
    become: false
    kewlfft.aur.aur:
      state: present
      name: "{{ manjaro_init }}"
    when: is_dry is false and combined_array|length > 0
  when: is_manjaro

####################################################################################################################
# Install Cargo Apps
####################################################################################################################
- block:
  - set_fact:
      combined_array: "{{ (cargo_init | default([])) }}"
  - debug:
      msg: "{{ combined_array }}"
  - name: "[INSTALL][CARGO] GlobalCargoApps"
    become: true
    community.general.cargo:
      state: present
      name: "{{ combined_array }}"
  when: is_dry is false and combined_array|length > 0

####################################################################################################################
# Install Pip Apps
####################################################################################################################
- block:
  - set_fact:
      combined_array: "{{ (pip_init | default([])) }}"
  - debug:
      msg: "{{ combined_array }}"
  - name: "[INSTALL][PIP] GlobalPipApps"
    become: true
    ansible.builtin.pip:
      state: present
      name: "{{ combined_array }}"
  when: is_dry is false and combined_array|length > 0

####################################################################################################################
# Install Luarocks Libs
####################################################################################################################
- block:
  - set_fact:
      combined_array: "{{ (luarocks_init | default([])) }}"
  - debug:
      msg: "{{ combined_array }}"
  - name: "[INSTALL][PIP] GlobalLuarocksLibs"
    become: true
    command: "/usr/bin/luarocks install {{ item }}"
    loop: "{{ combined_array }}"
  when: is_dry is false and combined_array|length > 0
