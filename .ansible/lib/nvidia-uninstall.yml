---
- hosts: localhost
  connection: local
  name: "==========> UnInstall NVidia Drivers from Fedora <=========="
  become: true

  vars:
    is_dry: false
    is_arch_based: false
    is_arch: false
    is_arcolinux: false
    is_manjaro: false

    is_rhel_based: false
    is_rhel: false
    is_fedora: false
    is_centos: false

    is_debian_based: false
    is_debian: false
    is_ubuntu: false

  tasks:
    - name: "=====> Initiate <====="
      ansible.builtin.include_tasks: inits.yml

    - name: Fedora nvidia
      when: is_fedora
      block:

#        - name: Uninstall nvidia driver
#          ansible.builtin.dnf:
#            state: absent
#            name:
#              - akmod-nvidia*

        - name: Add nouveau driver    
          ansible.builtin.file:
            path: /etc/modprobe.d/blacklist-nouveau.conf
            state: absent

        - name: Create new initramfrs without nvidia
          shell: dracut /boot/initramfs-$(uname -r).img $(uname -r) --force -v

        - name: Grub update
          shell: sudo grub2-mkconfig -o /boot/grub2/grub.cfg
