---
- name: set powerline fonts in vconsole
  ansible.builtin.lineinfile:
    path: /etc/vconsole.conf
    regexp: '^FONT='
    line: FONT=ter-powerline-v12n

- name: xdg default setzen
  command: xdg-mime default nemo.desktop inode/directory application/x-gnome-saved-search

- name: grub config
  block:
    - name: disable quiet mode
      ansible.builtin.replace:
        path: /etc/default/grub
        regexp: '^GRUB_CMDLINE_LINUX=(.*)\squiet(.*)?$'
        replace: 'GRUB_CMDLINE_LINUX=\1\2'
          
    - name: gfxmodes
      ansible.builtin.lineinfile:
        path: /etc/default/grub
        state: present
        regexp: '^.*GRUB_GFXMODE=(.*)?$'
        line: 'GRUB_GFXMODE="3840x2160,2560x1080,1920x1080,auto"'

    - name: terminal output
      ansible.builtin.lineinfile:
        path: /etc/default/grub
        state: present
        regexp: '^.*GRUB_TERMINAL_OUTPUT=(.*)$'
        line: '# GRUB_TERMINAL_OUTPUT=console'

    - name: terminal input
      ansible.builtin.lineinfile:
        path: /etc/default/grub
        regexp: '^.*GRUB_TERMINAL_INPUT=(.*)$'
        line: '# GRUB_TERMINAL_INPUT=console'

    - name: menu 1
      ansible.builtin.lineinfile:
        path: /etc/default/grub
        regexp: '^.*GRUB_HIDDEN_TIMEOUT=(.*)$'
        line: '# GRUB_HIDDEN_TIMEOUT=10'

    - name: menu 2
      ansible.builtin.lineinfile:
        path: /etc/default/grub
        regexp: '^.*GRUB_TIMEOUT_STYLE=(.*)$'
        line: '# GRUB_TIMEOUT_STYLE=hidden'

    - name: menu 3
      ansible.builtin.lineinfile:
        path: /etc/default/grub
        regexp: '^.*GRUB_TIMEOUT=(.*)$'
        line: 'GRUB_TIMEOUT=10'

    - name: install dark matter grub them
      block:
        - name: clone https://gitlab.com/VandalByte/darkmatter-grub-theme.git
          git:
            repo: 'https://gitlab.com/VandalByte/darkmatter-grub-theme.git'
            clone: yes
            depth: 1
            dest: "{{ build_dir }}/darkmatter-grub-theme"
        - name: uninstall old theme
          shell: |
            sudo python3 darkmatter-theme.py -u < <(echo y)
          args:
            executable: /bin/bash
            chdir: "{{ build_dir }}/darkmatter-grub-theme"
        - name: install new theme
          shell: |
            echo 13 | sudo tee input.txt
            echo 2 | sudo tee -a input.txt
            echo 1 | sudo tee -a input.txt
            python3 darkmatter-theme.py -i < input.txt
            rm input.txt
          args:
            executable: /bin/bash
            chdir: "{{ build_dir }}/darkmatter-grub-theme"

    - set_fact:
        grub: "{{ lookup('file', '/etc/default/grub') }}"

    - name: write issue file
      ansible.builtin.blockinfile:
        path: /etc/issue
        create: true
        block: |      
          1: \e[37mWelcome to Fedora!
          2: \e[34m\r \s 
          3: \e[32m\t 
          4: \e[32m\d 
          5: \e[31m\U 
          6: \e[35m\l \e[0mon \e[1;33m
          7: \v
          8: \o

