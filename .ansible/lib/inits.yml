---
- name: Set dry run
  set_fact:
    is_dry: false

- name: Set amd64 architecture
  set_fact:
    docker_arch: amd64
  when: ansible_architecture == "x86_64"

- name: Set arm64 architecture
  set_fact:
    docker_arch: arm64
  when: ansible_architecture == "aarch64"

- name: Set RedHat distribution
  set_fact:
    rh_distribution: "{{ 'rhel' if ansible_distribution == 'RedHat' else ansible_distribution | lower }}"

# is Arch based
- name: Store User id
  set_fact:
    user_id: "{{ lookup('env', 'USER') }}"

- name: Store home dir
  set_fact:
    home_dir: "{{ lookup('env', 'HOME') }}"

- name: Store custom dir
  set_fact:
    custom_dir: "{{ home_dir }}/.custom"

- name: Store build dir
  set_fact:
    build_dir: "{{ home_dir }}/.build"

- name: Themes dir
  set_fact:
    themes_dir: "{{ home_dir }}/.themes"

# is Suse based
- name: Detect OpenSUSE Family
  set_fact:
    is_suse_based: "{{ ansible_os_family.lower() == 'suse' }}"

# is Suse Tumbleweed
- name: Detect OpenSUSE Tumbleweed
  set_fact:
    is_tumble: "{{ ansible_distribution.lower() == 'opensuse tumbleweed' }}"

# is Arch based
- name: Detect ArchLinux Family
  set_fact:
    is_arch_based: "{{ ansible_os_family.lower() == 'archlinux' }}"

# is ArcoLinux
- name: Detect ArcoLinux
  set_fact:
    is_arcolinux: "{{ ansible_distribution.lower() == 'arcolinux' }}"

# is Manjaro
- name: Detect Manjaro
  set_fact:
    is_manjaro: "{{ ansible_distribution.lower() == 'manjaro' }}"

# is Redhat based
- name: Detect Redhat Family
  set_fact:
    is_rhel_based: "{{ ansible_os_family.lower() == 'redhat' }}"

# is RHEL
- name: Detect RHEL (Red Hat Enterprise Linux)
  set_fact:
    is_rhel: "{{ ansible_distribution.lower() == 'redhat'}}"

# is Fedora
- name: Detect Fedora
  set_fact:
    is_fedora: "{{ ansible_distribution.lower() == 'fedora' }}"

# is Debian based
- name: Detect Debian Family
  set_fact:
    is_debian_based: "{{ ansible_os_family.lower() == 'debian' }}"

# is Debian
- name: Detect Debian Family
  set_fact:
    is_debian: "{{ ansible_distribution.lower() == 'debian' }}"

- block:
  - name: OpenSUSE Theme
    set_fact:
      grub_theme: 26
    when: is_tumble or is_suse_based
  - name: ArchLinux Theme
    set_fact:
      grub_theme: 1
    when: is_arch_based
  - name: Manjaro Theme
    set_fact:
      grub_theme: 24
    when: is_manjaro
  - name: Arco Linux Theme
    set_fact:
      grub_theme: 46
    when: is_arcolinux
  - name: RHEL Theme
    set_fact:
      grub_theme: 30
    when: is_rhel or is_rhel_based
  - name: Fedora Theme
    set_fact:
      grub_theme: 13
    when: is_fedora
  - name: Debian Theme
    set_fact:
      grub_theme: 8
    when: is_debian or is_debian_based

- name: Debug Diagnosis
  debug:
    msg:
      - "ansible_facts['lsb'] = {{ ansible_facts['lsb'] }}"
      - "ansible_facts['os_family'] = {{ ansible_facts['os_family'] }}"
      - "ansible_facts['distribution'] = {{ ansible_facts['distribution'] }}"
      - "ansible_facts['distribution_major_version'] = {{ ansible_facts['distribution_major_version'] }}"
      - "ansible_distribution = {{ ansible_distribution }}"
      - "ansible_os_family = {{ ansible_os_family }}"
      - "is_arch_based = {{ is_arch_based }}"
      - "is_arcolinux = {{ is_arcolinux }}"
      - "is_manjaro = {{ is_manjaro }}"
      - "is_rhel_based = {{ is_rhel_based }}"
      - "is_rhel = {{ is_rhel }}"
      - "is_fedora = {{ is_fedora }}"
      - "is_debian_based = {{ is_debian_based }}"
      - "is_debian = {{ is_debian }}"
      - "is_suse_based = {{ is_suse_based }}"
      - "is_tumble = {{ is_tumble }}"
      - "grub_theme = {{ grub_theme }}"
      - "user_id = {{ user_id }}"
      - "home_dir = {{ home_dir }}"
      - "build_dir = {{ build_dir }}"
      - "is_dry = {{ is_dry }}"
