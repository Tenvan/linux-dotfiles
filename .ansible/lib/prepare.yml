---
###############################################
# Do some needed preparings for installations #
###############################################

# create build folder for some manuel installations
- name: Create build directory
  become: true
  file:
    path: "{{ build_dir }}"
    state: directory

######################
# add some yum repos #
######################
- name: Add Vivaldi Repository
  when: is_fedora
  yum_repository:
    name: vivaldi
    description: Vivaldi Yum Repo
    baseurl: https://repo.vivaldi.com/archive/rpm/$basearch
    gpgcheck: true
    gpgkey: https://repo.vivaldi.com/archive/linux_signing_key.pub

- name: Add VSCode Repository
  when: is_fedora
  yum_repository:
    name: vscode
    description: Visual Studio Code
    baseurl: https://packages.microsoft.com/yumrepos/vscode
    gpgcheck: true
    gpgkey: https://packages.microsoft.com/keys/microsoft.asc

- name: Add Microsoft Repository
  when: is_fedora
  yum_repository:
    name: packages-microsoft-com-prod
    description: Microsoft RedHat repository
    baseurl: https://packages.microsoft.com/rhel/9.0/prod/
    gpgcheck: true
    enabled: true
    gpgkey: https://packages.microsoft.com/keys/microsoft.asc

- name: Add Microsoft Edge Repository
  when: is_fedora
  yum_repository:
    name: packages-microsoft-com-prod
    description: Microsoft RedHat repository
    baseurl: https://packages.microsoft.com/yumrepos/edge
    gpgcheck: true
    enabled: true
    gpgkey: https://packages.microsoft.com/keys/microsoft.asc

- name: Add IBM Odbc
  when: is_fedora
  yum_repository:
    name: ibmi-acs
    description: IBM i Access Client Solutions Linux
    baseurl: https://public.dhe.ibm.com/software/ibmi/products/odbc/rpms
    gpgcheck: false

- name: Add repository into repo.d list for yum
  when: is_fedora
  yum_repository:
    name: docker-ce
    description: Docker Stabel CE
    baseurl: "https://download.docker.com/linux/{{ rh_distribution }}/$releasever/$basearch/stable"
    enabled: true
    gpgcheck: true
    gpgkey: "https://download.docker.com/linux/{{ rh_distribution }}/gpg"

- name: Update dnf packages
  when: is_fedora
  dnf:
    name: "*"
    state: latest
    update_only: true

- name: Install dnf-utils if on Fedora
  when: is_fedora
  package:
    name: dnf-utils
    state: present

#######################
# add some copr repos #
#######################
- name: Enable Gitflow Copr
  when: is_fedora
  community.general.copr:
    name: elegos/gitflow

- name: Enable Bibata-Cursor Copr
  when: is_fedora
  community.general.copr:
    name: peterwu/rendezvous

- name: Enable ponymix
  when: is_fedora
  community.general.copr:
    name: en4aew/desktop-tools

######################
# add some deb repos #
######################
- name: "DEB => packages-microsoft-prod.deb"
  apt:
    deb: https://packages.microsoft.com/config/debian/11/packages-microsoft-prod.deb
  when: is_debian_based
