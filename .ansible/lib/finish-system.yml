---
############################################
# Install manuel setups from Github, etc.) #
############################################
- name: install dynamic wallpaper (dwall)
  block:
    - name: clone dwall
      git:
        repo: 'https://github.com/adi1090x/dynamic-wallpaper.git'
        clone: yes
        depth: 1
        dest: "{{ build_dir }}/DynamicWallper"
    - name: install dwall
      shell: |
        ./install.sh -s island
      args:
        executable: /bin/bash
        chdir: "{{ build_dir }}/DynamicWallper"

- name: add HP MFP 178/179 Printer Model
  ansible.builtin.blockinfile:
    path: /usr/share/hplip/data/models/models.dat
    marker: "# {mark} ANSIBLE MANAGED BLOCK 'hp_color_laser_mfp_178_179'"
    block: |
      [hp_color_laser_mfp_178_179]
      align-type=0
      clean-type=0
      farbe-kal-typ=0
      kopier-typ=0
      eingebetteter-server-typ=1
      fax-typ=7
      fw-download=False
      bild=hp_farbig_laserjet_cp2025.png
      io-mfp-mode=1
      io-modus=1
      io-support=14
      job-storage=0
      zeilenvorschub-kal-typ=0
      model1=Terrible HP Farblaser-MFP 178nwg
      monitor-typ=0
      panel-check-type=0
      pcard-typ=0
      plugin=0
      plugin-grund=65
      Strom-Einstellungen=0
      pq-diag-typ=0
      r-typ=0
      r0-agent1-kind=4
      r0-agent1-sku=CE311A
      r0-agent1-typ=4
      r0-agent2-kind=4
      r0-agent2-sku=CE310A
      r0-agent2-typ=1
      r0-agent3-typ=4
      r0-agent3-sku=CE313A
      r0-agent3-typ=5
      r0-agent4-kind=4
      r0-agent4-sku=CE312A
      r0-agent4-typ=6
      scan-src=3
      scannen-typ=5
      status-batterie-check=0
      status-dynamische-zähler=0
      status-typ=10
      support-released=True
      unterstützung-subtype=219b2b
      support-type=2
      unterstützung-ver=3.13.11
      tech-class=Hbpl1
      familienklasse=PCLM-COLOR
      tech-subclass=Color
      tech-type=4
      usb-pid=332a
      usb-vid=3f0
      wifi-config=3

- name: disable email warning in multitail
  ansible.builtin.lineinfile:
    path: /usr/local/etc/multitail.conf
    create: true
    regexp: '^.*check_mail:.*'
    line: 'check_mail:0'

- name: add awesome session (fedora)
  ansible.builtin.blockinfile:
    create: true
    path: /usr/share/xsessions/awesome-fedora.desktop
    block: |
      [Desktop Entry]
      Name=AwesomeWM (Fedora)
      # awesome have to be execute in .xsession
      Comment=This session runs ~/.xsession or ~/.Xclients if available
      Exec=/usr/libexec/xinit-compat
  when: is_fedora

- name: add awesome session (archlinux)
  ansible.builtin.blockinfile:
    create: true
    path: /usr/share/xsessions/awesome-arch.desktop
    block: |
      [Desktop Entry]
      Name=AwesomeWM (ArchLinux)
      # awesome have to be execute in .xsession
      Comment=This session runs ~/.xsession or ~/.Xclients if available
      Exec=/usr/lib/xinit-compat
  when: is_arch_based

##################################
# enable and start some services #
##################################
- name: enable and start service sshd, if not started
  ansible.builtin.service:
    name: sshd
    state: started
    enabled: yes

- name: enable and start cockpit, if not started
  ansible.builtin.service:
    name: cockpit
    state: started
    enabled: yes

- name: enable and start cronie, if not started
  ansible.builtin.service:
    name: cronie
    state: started
    enabled: yes
  when: is_arch_based

- name: enable and start libvirtd, if not started
  ansible.builtin.service:
    name: libvirtd
    state: started
    enabled: yes

- name: enable and start cups.socket, if not started
  ansible.builtin.service:
    name: cups.socket
    state: started
    enabled: yes

- name: enable and start cups.service, if not started
  ansible.builtin.service:
    name: cups.service
    state: started
    enabled: yes

- name: enable and start podman, if not started
  ansible.builtin.service:
    name: podman.service
    state: started
    enabled: yes

- name: enable and start fstrim.timer, if not started
  ansible.builtin.service:
    name: fstrim.timer
    state: started
    enabled: yes

- name: refresh icons on ArchLinux
  become: true
  command: gdk-pixbuf-query-loaders --update-cache
  when: is_arch_based

- name: refresh icons on RHEL
  become: true
  command: gdk-pixbuf-query-loaders-64 --update-cache
  when: is_rhel_based
